name: Check PAT Secret

on:
  workflow_call:
    secrets:
      token:
        required: true

jobs:
  test-pat:
    runs-on: ubuntu-latest
    steps:
      - name: Test if PAT works
        run: |
          status=$(curl -s -o /dev/null -w "%{http_code}" \
            -H "Authorization: token ${{ secrets.token }}" \
            https://api.github.com/user)

          if [ "$status" -ne 200 ]; then
            echo "âŒ PAT is invalid or missing (status: $status)"
            exit 1
          else
            user=$(curl -s -H "Authorization: token ${{ secrets.token }}" https://api.github.com/user | jq -r .login)
            echo "âœ… PAT is valid for user: $user"
            echo "ğŸ“¦ Repo: ${{ github.repository }}"
            echo "::notice::ğŸ‰ PAT check passed!"
          fi
