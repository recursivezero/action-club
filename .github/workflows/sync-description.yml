name: Sync Repo Description
run-name: "Sync description from README on branch: ${{ github.ref_name }}"

on:
  push:
    branches: [main]

jobs:
  update-description:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Extract description from README
        id: readme
        run: |
          DESC=$(head -n 1 README.md | sed 's/# //')
          echo "Extracted description: $DESC"
          echo "desc=$DESC" >> $GITHUB_ENV

      - name: Update repo description via API
        run: |
          echo "Updating repo description to: ${{ env.desc }}"
          curl -X PATCH \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/${{ github.repository }} \
            -d "{\"description\":\"${{ env.desc }}\"}"
